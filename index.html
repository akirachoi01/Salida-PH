<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TMDB Browser + VIP Player</title>
<style>
    body { font-family: Arial, sans-serif; background: #111; color: white; margin: 0; padding: 0; }
    header { text-align: center; padding: 15px; }
    select, input, button { padding: 8px; font-size: 16px; margin: 5px; }
    #results { display: flex; flex-wrap: wrap; gap: 15px; padding: 20px; justify-content: center; }
    .result { cursor: pointer; width: 150px; text-align: center; }
    .result img { width: 100%; border-radius: 5px; transition: transform 0.2s; }
    .result img:hover { transform: scale(1.05); }
    iframe { width: 100%; height: 80vh; border: none; margin-top: 20px; display: none; }
    #loadMoreBtn { display: none; background: #34cfeb; color: white; border: none; cursor: pointer; border-radius: 4px; }
</style>
</head>
<body>

<header>
    <h1>üé¨ Browse TMDB & Play VIP</h1>
    <select id="category">
        <option value="">-- Select Category --</option>
        <option value="latest_movies">üìΩ Latest Movies</option>
        <option value="latest_tv">üì∫ Latest TV Shows</option>
        <option value="popular_movies">üî• Popular Movies</option>
        <option value="popular_tv">‚≠ê Popular TV Shows</option>
    </select>
    <input type="text" id="searchBox" placeholder="Or search movie/TV show..." />
</header>

<div id="results"></div>
<div style="text-align:center;">
    <button id="loadMoreBtn">Load More</button>
</div>
<iframe id="player" allowfullscreen referrerpolicy="origin"></iframe>

<script>
const API_KEY = "ba3885a53bc2c4f3c4b5bdc1237e69a0";
let currentCategory = "";
let currentPage = 1;
let lastQuery = "";
let searchMode = false;

document.getElementById("searchBox").addEventListener("keyup", function(e) {
    if (e.key === "Enter") {
        searchMode = true;
        lastQuery = this.value;
        currentPage = 1;
        searchTMDB(lastQuery, true);
    }
});

document.getElementById("category").addEventListener("change", function() {
    if (this.value) {
        searchMode = false;
        currentCategory = this.value;
        currentPage = 1;
        loadCategory(currentCategory, true);
    }
});

document.getElementById("loadMoreBtn").addEventListener("click", function() {
    currentPage++;
    if (searchMode) {
        searchTMDB(lastQuery, false);
    } else {
        loadCategory(currentCategory, false);
    }
});

function searchTMDB(query, clear) {
    fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}&page=${currentPage}`)
        .then(res => res.json())
        .then(data => renderResults(data.results, clear));
}

function loadCategory(cat, clear) {
    let url = "";
    if (cat === "latest_movies") url = `https://api.themoviedb.org/3/movie/now_playing?api_key=${API_KEY}&language=en-US&page=${currentPage}`;
    if (cat === "latest_tv") url = `https://api.themoviedb.org/3/tv/on_the_air?api_key=${API_KEY}&language=en-US&page=${currentPage}`;
    if (cat === "popular_movies") url = `https://api.themoviedb.org/3/movie/popular?api_key=${API_KEY}&language=en-US&page=${currentPage}`;
    if (cat === "popular_tv") url = `https://api.themoviedb.org/3/tv/popular?api_key=${API_KEY}&language=en-US&page=${currentPage}`;

    fetch(url)
        .then(res => res.json())
        .then(data => renderResults(data.results, clear));
}

function renderResults(items, clear) {
    const resultsDiv = document.getElementById("results");
    if (clear) resultsDiv.innerHTML = "";
    items.forEach(item => {
        const tmdbId = item.id;
        const title = item.title || item.name;
        const poster = item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : "";
        const mediaType = item.media_type || (item.first_air_date ? "tv" : "movie");

        if (!poster) return;

        const div = document.createElement("div");
        div.className = "result";
        div.innerHTML = `<img src="${poster}" alt="${title}"><br>${title}`;
        div.onclick = () => loadPlayer(tmdbId, mediaType);
        resultsDiv.appendChild(div);
    });

    document.getElementById("loadMoreBtn").style.display = items.length > 0 ? "inline-block" : "none";
}

function loadPlayer(tmdbId, type) {
    const iframe = document.getElementById("player");
    iframe.style.display = "block";

    let season = 0, episode = 0;
    if (type === "tv") { season = 1; episode = 1; }

    iframe.src = `/player.php?video_id=${tmdbId}&tmdb=1&season=${season}&episode=${episode}`;
    window.scrollTo(0, document.body.scrollHeight);
}

window.onload = function() {
    currentCategory = "latest_movies";
    document.getElementById("category").value = "latest_movies";
    loadCategory(currentCategory, true);
};
</script>

</body>
</html>
